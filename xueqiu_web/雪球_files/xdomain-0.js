(function(e,t){(function(e,t){var n,r,o,i,a,s,u,c,f,d,l,p,h,y,v,g,m,x,b,w,E,k=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};v=e.document,r="before",n="after",d="readyState",f="addEventListener",c="removeEventListener",a="dispatchEvent",h="XMLHttpRequest",s="FormData",l=["load","loadend","loadstart"],o=["progress","abort","error","timeout"],(E=Array.prototype).indexOf||(E.indexOf=function(e){var t,n,r,o;for(t=r=0,o=this.length;o>r;t=++r)if(n=this[t],n===e)return t;return-1}),b=function(e,t){return Array.prototype.slice.call(e,t)},m=function(e,t){var n,r;for(n in e)if(r=e[n],"returnValue"!==n)try{t[n]=e[n]}catch(o){}return t},x=function(e,t,n){var r,o,i,s;for(o=function(e){return function(r){var o,i,s;o={};for(i in r)"returnValue"!==i&&(s=r[i],o[i]=s===t?n:s);return n[a](e,o)}},i=0,s=e.length;s>i;i++)r=e[i],t["on"+r]=o(r)},g=function(e){var t;if(null!=v.createEventObject)return t=v.createEventObject(),t.type=e,t;try{return new Event(e)}catch(n){return{type:e}}},i=function(e){var n,r,o;return r={},o=function(e){return r[e]||[]},n={},n[f]=function(e,n,i){r[e]=o(e),r[e].indexOf(n)>=0||(i=i===t?r[e].length:i,r[e].splice(i,0,n))},n[c]=function(e,t){var n;n=o(e).indexOf(t),-1!==n&&o(e).splice(n,1)},n[a]=function(){var r,i,a,s,u,c,f,d;for(r=b(arguments),i=r.shift(),e||(r[0]=m(r[0],g(i))),s=n["on"+i],s&&s.apply(t,r),d=o(i).concat(o("*")),a=c=0,f=d.length;f>c;a=++c)u=d[a],u.apply(t,r)},e&&(n.listeners=function(e){return b(o(e))},n.on=n[f],n.off=n[c],n.fire=n[a],n.once=function(e,t){var r;return r=function(){return n.off(e,r),t.apply(null,arguments)},n.on(e,r)},n.destroy=function(){return r={}}),n},w=i(!0),w.EventEmitter=i,w[r]=function(e,t){if(e.length<1||e.length>2)throw"invalid hook";return w[f](r,e,t)},w[n]=function(e,t){if(e.length<2||e.length>3)throw"invalid hook";return w[f](n,e,t)},w.enable=function(){e[h]=p},w.disable=function(){e[h]=w[h]},y=w.headers=function(e,t){var n,r,o,i,a,s,u,c,f;switch(null==t&&(t={}),typeof e){case"object":r=[];for(o in e)a=e[o],i=o.toLowerCase(),r.push(""+i+":	"+a);return r.join("\n");case"string":for(r=e.split("\n"),u=0,c=r.length;c>u;u++)n=r[u],/([^:]+):\s*(.+)/.test(n)&&(i=null!=(f=RegExp.$1)?f.toLowerCase():void 0,s=RegExp.$2,null==t[i]&&(t[i]=s));return t}},u=e[s],u&&(w[s]=u,e[s]=function(e){var t;this.fd=e?new u(e):new u,this.form=e,t=[],Object.defineProperty(this,"entries",{get:function(){var n;return n=e?b(e.querySelectorAll("input,select")).filter(function(e){var t;return"checkbox"!==(t=e.type)&&"radio"!==t||e.checked}).map(function(e){return[e.name,"file"===e.type?e.files:e.value]}):[],n.concat(t)}}),this.append=function(e){return function(){var n;return n=b(arguments),t.push(n),e.fd.append.apply(e.fd,n)}}(this)}),w[h]=e[h],p=e[h]=function(){var t,u,c,p,v,g,b,E,T,L,R,C,O,q,M;return M=new w[h],v=!1,C=!1,T={},T.headers={},T.headerNames={},L={},L.headers={},E=function(){var e,t,n,r;L.status=M.status,L.statusText=M.statusText,r=y(M.getAllResponseHeaders());for(e in r)n=r[e],L.headers[e]||(t=e.toLowerCase(),L.headers[t]=n)},b=function(){try{L.text=M.responseText}catch(e){}try{L.xml=M.responseXML}catch(e){}L.data=M.response||L.text},q=function(){p.status=L.status,p.statusText=L.statusText},O=function(){L.hasOwnProperty("text")&&(p.responseText=L.text),L.hasOwnProperty("xml")&&(p.responseXML=L.xml),p.response=L.data||null},c=function(e){for(;e>t&&4>t;)p[d]=++t,1===t&&p[a]("loadstart",{}),2===t&&q(),4===t&&(q(),O()),p[a]("readystatechange",{}),4===t&&setTimeout(u,0)},u=function(){v||p[a]("load",{}),p[a]("loadend",{}),v&&(p[d]=0)},t=0,R=function(e){var t,r;return 4!==e?void c(e):(t=w.listeners(n),r=function(){var e;return t.length?(e=t.shift(),2===e.length?(e(T,L),r()):3===e.length&&T.async?e(T,L,r):r()):c(4)},void r())},p=T.xhr=i(),M.onreadystatechange=function(){try{2===M[d]&&E()}catch(e){}4===M[d]&&(C=!1,E(),b()),R(M[d])},g=function(){v=!0},p[f]("error",g),p[f]("timeout",g),p[f]("abort",g),p[f]("progress",function(){3>t?R(3):p[a]("readystatechange",{})}),x(o,M,p),("withCredentials"in M||w.addWithCredentials)&&(p.withCredentials=!1),p.status=0,p.open=function(e,t,n,r,o){T.method=e,T.url=t,T.async=n!==!1,T.user=r,T.pass=o,R(1)},p.send=function(t){var n,o,i,a,u,c,f,d;for(d=["type","timeout","withCredentials"],c=0,f=d.length;f>c;c++)o=d[c],i="type"===o?"responseType":o,i in p&&(T[o]=p[i]);T.body=t,u=function(){var t,n,r,a,u,c;for(C=!0,M.open(T.method,T.url,T.async,T.user,T.pass),u=["type","timeout","withCredentials"],r=0,a=u.length;a>r;r++)o=u[r],i="type"===o?"responseType":o,o in T&&(M[i]=T[o]);c=T.headers;for(t in c)n=c[t],M.setRequestHeader(t,n);e[s]&&T.body instanceof e[s]&&(T.body=T.body.fd),M.send(T.body)},n=w.listeners(r),(a=function(){var e,t;return n.length?(e=function(e){return"object"!=typeof e||"number"!=typeof e.status&&"number"!=typeof L.status?void a():(m(e,L),k.call(e,"data")<0&&(e.data=e.response||e.text),void R(4))},e.head=function(e){return m(e,L),R(2)},e.progress=function(e){return m(e,L),R(3)},t=n.shift(),1===t.length?e(t(T)):2===t.length&&T.async?t(T,e):e()):u()})()},p.abort=function(){C?M.abort():p[a]("abort",{})},p.setRequestHeader=function(e,t){var n,r;n=null!=e?e.toLowerCase():void 0,r=T.headerNames[n]=T.headerNames[n]||e,T.headers[r]&&(t=T.headers[r]+", "+t),T.headers[r]=t},p.getResponseHeader=function(e){var t;return t=null!=e?e.toLowerCase():void 0,L.headers[t]},p.getAllResponseHeaders=function(){return y(L.headers)},M.overrideMimeType&&(p.overrideMimeType=function(){return M.overrideMimeType.apply(M,arguments)}),M.upload&&(p.upload=T.upload=i(),x(o.concat(l),M.upload,p.upload)),p},"function"==typeof this.define&&this.define.amd?define("xdomain-0.6.15.js",[],function(){return w}):(this.exports||this).xhook=w}).call(this,e);var n,r,o,i,a,s,u,c,f,d,l,p,h,y,v,g,m,x,b,w,E,k,T,L,R,C,O,q,M,A,D,X,H,j,N,B,F,S;O=null,a=function(e){var t,n;null===O&&(O={},g());for(t in e)n=e[t],k("adding slave: "+t),O[t]=n},p={},h=function(e,t){var n;return p[e]?p[e]:(n=d.createElement("iframe"),n.id=n.name=y(),k("creating iframe "+n.id),n.src=""+e+t,n.setAttribute("style","display:none;"),d.body.appendChild(n),p[e]=n.contentWindow)},g=function(){var e,t,n;return t=function(e,t){var n,r,o,i,a;return o=e[0],i=e[1],n=x(i,"Blob"),r=x(i,"File"),n||r?(a=new FileReader,a.onload=function(){return e[1]=null,r&&(e[2]=i.name),t(["XD_BLOB",e,this.result,i.type])},a.readAsArrayBuffer(i),1):0},e=function(e,n){var r;e.forEach(function(t,n){var r,o,i,a,s;if(o=t[0],i=t[1],x(i,"FileList"))for(e.splice(n,1),a=0,s=i.length;s>a;a++)r=i[a],e.splice(n,0,[o,r])}),r=0,e.forEach(function(o,i){r+=t(o,function(t){e[i]=t,0===--r&&n()})}),0===r&&n()},n=function(t,n){var r,o,i;return n.on("xhr-event",function(){return t.xhr.dispatchEvent.apply(null,arguments)}),n.on("xhr-upload-event",function(){return t.xhr.upload.dispatchEvent.apply(null,arguments)}),o=D(t),o.headers=t.headers,t.withCredentials&&(o.credentials=d.cookie),i=function(){return n.emit("request",o)},t.body&&(o.body=t.body,x(o.body,"FormData"))?(r=o.body.entries,o.body=["XD_FD",r],void e(r,i)):void i()},N.addWithCredentials=!0,N.before(function(e,t){var r,o,i;return o=C(e.url),o&&o.origin!==f?O[o.origin]?(k("proxying request to slave: '"+o.origin+"'"),e.async===!1?(H("sync not supported"),t()):(r=h(o.origin,O[o.origin]),i=s(r),i.on("response",function(e){return t(e),i.close()}),e.xhr.addEventListener("abort",function(){return i.emit("abort")}),void(i.ready?n(e,i):i.once("ready",function(){return n(e,i)})))):(o&&k("no slave matching: '"+o.origin+"'"),t()):t()})},L=null,i=function(e){var t,n;null===L&&(L={},m());for(t in e)n=e[t],k("adding master: "+t),L[t]=n},m=function(){return w(function(e,t){var n,r,o,i;"null"===e&&(e="*"),o=null;for(n in L){i=L[n];try{if(r=X(n),r.test(e)){o=X(i);break}}catch(a){}}return o?(t.once("request",function(e){var n,r,i,a,s,u,c,f,d,l,p;if(k("request: "+e.method+" "+e.url),u=C(e.url),!u||!o.test(u.path))return H("blocked request to path: '"+u.path+"' by regex: "+o),void t.close();f=new XMLHttpRequest,f.open(e.method,e.url),f.addEventListener("*",function(e){return t.emit("xhr-event",e.type,D(e))}),f.upload&&f.upload.addEventListener("*",function(e){return t.emit("xhr-upload-event",e.type,D(e))}),t.once("abort",function(){return f.abort()}),f.onreadystatechange=function(){var e;if(4===f.readyState){e={status:f.status,statusText:f.statusText,data:f.response,headers:N.headers(f.getAllResponseHeaders())};try{e.text=f.responseText}catch(n){}return t.emit("response",e)}},e.withCredentials&&(e.headers["XDomain-Cookie"]=e.credentials),e.timeout&&(f.timeout=e.timeout),e.type&&(f.responseType=e.type),p=e.headers;for(s in p)c=p[s],f.setRequestHeader(s,c);if(e.body instanceof Array&&"XD_FD"===e.body[0]){for(a=new N.FormData,i=e.body[1],d=0,l=i.length;l>d;d++)n=i[d],"XD_BLOB"===n[0]&&4===n.length&&(r=new Blob([n[2]],{type:n[3]}),n=n[1],n[1]=r),a.append.apply(a,n);e.body=a}f.send(e.body||null)}),void k("slave listening for requests on socket: "+t.id)):void H("blocked request from: '"+e+"'")}),e===e.parent?H("slaves must be in an iframe"):e.parent.postMessage("XDPING_"+r,"*")},R=function(t){return d.addEventListener?e.addEventListener("message",t):e.attachEvent("onmessage",t)},o="XD_CHECK",v=null,M={},b=!0,A=function(){return R(function(e){var n,o,i,a;if(n=e.data,"string"==typeof n){if(/^XDPING(_(V\d+))?$/.test(n)&&RegExp.$2!==r)return H("your master is not compatible with your slave, check your xdomain.js version");if(/^xdomain-/.test(n))n=n.split(",");else if(b)try{n=JSON.parse(n)}catch(s){return}}if(n instanceof Array&&(i=n.shift(),/^xdomain-/.test(i)&&(a=M[i],null!==a))){if(a===t){if(!v)return;a=c(i,e.source),v(e.origin,a)}o="string"==typeof n[1]?": '"+n[1]+"'":"",k("receive socket: "+i+": '"+n[0]+"'"+o),a.fire.apply(a,n)}})},c=function(e,t){var r,i,a,s,u,c;return u=!1,c=M[e]=N.EventEmitter(!0),c.id=e,c.once("close",function(){return c.destroy(),c.close()}),s=[],c.emit=function(){var t,n;t=q(arguments),n="string"==typeof t[1]?": '"+t[1]+"'":"",k("send socket: "+e+": "+t[0]+n),t.unshift(e),u?a(t):s.push(t)},a=function(e){b&&(e=JSON.stringify(e)),t.postMessage(e,"*")},c.close=function(){c.emit("close"),k("close socket: "+e),M[e]=null},c.once(o,function(t){for(b="string"==typeof t,u=c.ready=!0,c.emit("ready"),k("ready socket: "+e+" (emit #"+s.length+" pending)");s.length;)a(s.shift())}),i=0,r=function(){return function(){t.postMessage([e,o,{}],"*"),u||(i++===j.timeout/n?H("Timeout waiting on iframe socket"):setTimeout(r,n))}}(this),setTimeout(r),k("new socket: "+e),c},s=function(e){var t;return t=c(y(),e)},w=function(e){v=e},N=(this.exports||this).xhook,j=function(e){e&&(e.masters&&i(e.masters),e.slaves&&a(e.slaves))},j.masters=i,j.slaves=a,j.debug=!1,j.timeout=15e3,n=100,d=e.document,E=e.location,f=j.origin=E.protocol+"//"+E.host,y=function(){return"xdomain-"+Math.round(Math.random()*Math.pow(2,32)).toString(16)},q=function(e,t){return Array.prototype.slice.call(e,t)},u=e.console||{},T=function(e){return function(t){t="xdomain ("+f+"): "+t,e in j&&j[e](t),("log"!==e||j.debug)&&e in u&&u[e](t)}},k=T("log"),H=T("warn"),S=["postMessage","JSON"];for(B=0,F=S.length;F>B;B++)if(l=S[B],!e[l])return void H("requires '"+l+"' and this browser does not support it");x=function(t,n){return n in e?t instanceof e[n]:!1},r="V1",C=j.parseUrl=function(e){return/^((https?:)?\/\/[^\/\?]+)(\/.*)?/.test(e)?{origin:(RegExp.$2?"":E.protocol)+RegExp.$1,path:RegExp.$3}:(k("failed to parse absolute url: "+e),null)},X=function(e){var t;return e instanceof RegExp?e:(t=e.toString().replace(/\W/g,function(e){return"\\"+e}).replace(/\\\*/g,".*"),new RegExp("^"+t+"$"))},D=function(e){var t,n,r,o;t={};for(n in e)"returnValue"!==n&&(r=e[n],"function"!=(o=typeof r)&&"object"!==o&&(t[n]=r));return t},function(){var e,t,n,r,o,s,u,c,f,l,p;for(e={debug:function(e){return"string"==typeof e?j.debug="false"!==e:void 0},slave:function(e){var t,n;if(e&&(t=C(e)))return n={},n[t.origin]=t.path,a(n)},master:function(e){var t,n;if(e&&(n="*"===e?{origin:"*",path:"*"}:C(e)))return t={},t[n.origin]=n.path.replace(/^\//,"")?n.path:"*",i(t)}},l=d.getElementsByTagName("script"),s=0,c=l.length;c>s;s++)if(o=l[s],/xdomain/.test(o.src))for(p=["","data-"],u=0,f=p.length;f>u;u++){r=p[u];for(n in e)(t=e[n])(o.getAttribute(r+n))}}(),A(),"function"==typeof this.define&&this.define.amd?define("xdomain",["xhook"],function(e){return N=e,j}):(this.exports||this).xdomain=j}).call(this,window);